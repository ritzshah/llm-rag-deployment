{{- if .Values.enabled }}
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    argocd.argoproj.io/hook: PreSync
  name: check-inferenceservice-configmap
  namespace: redhat-ods-operator
spec:
  template:
    spec:
      containers:
      - command:
        - /bin/sh
        - -c
        - "while true; do\necho \"Checking default InferenceService ConfigMap...\"\
          \n# Fetch current storageInitializer config\nconfig=$(oc get configmap inferenceservice-config\
          \ -n redhat-ods-applications -o jsonpath='{.data.storageInitializer}')\n\
          \n# Check if \"enableModelcar\" is already enabled\nif echo \"$config\"\
          \ | grep '\"enableModelcar\": true'; then\n  echo \"ModelCar enabled!\"\n\
          \  exit 0\nelse\n  echo \"ModelCar not enabled yet.\"\nfi\nsleep 5\ndone\n"
        image: image-registry.openshift-image-registry.svc:5000/openshift/tools:latest
        name: phase-check
      restartPolicy: Never
      serviceAccountName: presync-monitoring-sa
{{- end }}
